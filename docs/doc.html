<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Heiya Documentation - High Efficiency Image Conversion</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="scribbler-global.css">
    <link rel="stylesheet" href="scribbler-doc.css">
    <link rel="author" href="http://hongjunwu.com">
  </head>
  <body>
    <div class="doc__bg"></div>
    <nav class="header">
      <h1 class="logo">Heiya <span class="logo__thin">Doc</span></h1>
      <ul class="menu">
        <div class="menu__item toggle"><span></span></div>
        <li class="menu__item"><a href="https://github.com/wu-hongjun/heiya" class="link link--dark"><i class="fa fa-github"></i> Github</a></li>
        <li class="menu__item"><a href="index.html" class="link link--dark"><i class="fa fa-home"></i> Home</a></li>
      </ul>
    </nav>
    <div class="wrapper">
      <aside class="doc__nav">
        <ul>
          <li class="js-btn selected">Prerequisites</li>
          <li class="js-btn">Get Started</li>
          <li class="js-btn">Advanced Usage</li>
          <li class="js-btn">Heiya Functions</li>
          <li class="js-btn">To-Do</li>
          <li class="js-btn">License</li>
        </ul>
      </aside>
      <article class="doc__content">
        <section class="js-section">
          <h1 class="section__title">Chapter 1: Prerequisites</h1>
          <p>Long story short, Heiya runs on Python 3, so at a bare minimum you <strong>must</strong> have Python installed on your computer. 
            But there are also some optional things to make your life easier.</p>
          <h2>1.1 - (Optional but strongly recommended) Install Anaconda</h2>
          <p>Note: If you already have python, jupyter_notebook, and pyperclip installed on your computer, feel free to skip this section.</p>
          <p>In order to use it more easily, you might want to <strong>optionally</strong> install <code>jupyter_notebook</code>.</p>
          <p>Configuring <code>python</code> and <code>jupyter_notebook</code> might be a daunting task for those who are not familiar with using Python.
            Therefore, it would be much better if there is something that just takes care of everything automatically and not having to mess around with the code. 
            That is what Anaconda does.  
          </p>
          <strong>For the majority of people, you will want to just install Anaconda from their <a href="https://www.anaconda.com/">Official Website (Link)</a>.</strong>
          <p>
            Note I have no affiliation with Anaconda, it just makes setup and install python prerequisites much easier. 
            After you have Anaconda installed on your computer, it should already configured pip, jupyter_notebook, and python for you, and if you don't know what I am talking about, don't worry about it and just restart your computer.
          </p>
          <p>Of course, if you are familiar with python configuration, you can do it on your own, Anaconda is optional.</p>

            <h2>1.2 - Install Heiya (Mandatory)</h2>
            <p>Installation of Heiya should be fairly straight forward if you did the previous section or already have everything setup.</p>
            <p>Note: <strong>If you used Anaconda</strong>, run the following in <strong>Anaconda Prompt</strong> (Help in 1.2.2):</p>
            <div class="code__block code__block--notabs">
              <pre class="code code--block">
                <code>
                  conda activate base
                </code>
              </pre>
            </div>
            <div class="code__block code__block--notabs">
              <pre class="code code--block">
                <code>
                  pip install heiya
                </code>
              </pre>
            </div>
            <p>Once finished, it should look something like below.</p>
            <img src="./img/anaconda_prompt_finished.png" width="100%" height="100%">
            <p>If you <strong>configured on your own</strong>, simply run the following command in <strong>Terminal with administrator privileges</strong> (Help in 1.2.1).</p>
            <div class="code__block code__block--notabs">
              <pre class="code code--block">
                <code>
                  pip install heiya
                </code>
              </pre>
            </div>
            <h4>1.2.1 - Troubleshooting</h4>
              <p>If you encounter some error code, most likely one of two things is going wrong:</p>
              <li>1. You don't have pip installed on your computer. To solve this, run the following command to install pip.
                <div class="code__block code__block--notabs">
                  <pre class="code code--block">
                    <code>
                    curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
                    python get-pip.py
                    </code>
                  </pre>
                </div>
            </li>
            <li>
              2. You don't have the Admin permission to run the commands. You are most likely going to see something like: 
                <div class="code__block code__block--notabs">
                  <pre class="code code--block">
                    <code>
                      ERROR: Could not install packages due to an OSError: [WinError 5] Access is denied: 'c:\\python310\\scripts\\pip.exe'
                    </code>
                  </pre>
                </div>
                Just make sure you are running Terminal using Administrator privilidges.
            </li>
            <h3>1.2.2 - How to run Terminal with administrator priviledges?</h3>
            <h4>macOS</h4>
            <p>On macOS, it is pretty straight forward. Open Launchpad and search for "Terminal", and open that app.</p>
            <p>Type in the above command, and press enter. Terminal will prompt you to enter the password of your computer, just do it and it is complete.</p>
            <h4>Windows</h4>
            <p>On Windows 11, there are many ways to run Terminal (Or Powershell/Command Prompt if you are on Windows 10 or below, it is the same thing).</p>
            <p>Simply right click the Windows icon on the bottom left of your screen, and press the option to <strong>Run Terminal (or Powershell) as Admin</strong>.</p>
            <h3>1.2.2 - How to open Anaconda Prompt?</h3>
            <p>
              Open Anaconda Navigator, look for something that says "Anaconda Prompt/Powershell Prompt/CMD.exe Prompt". 
              Basically, anything with the name "Prompt" will probably do.
            </p>
            <p>Press "Launch".</p>
            <img src="./img/anaconda_prompt.png" width="100%" height="100%">
        </li>
        </section>

        <section class="js-section">
          <h1 class="section__title">Chapter 2: Get Started</h1>
          <p>
            For the most common usage, assuming you are a photographer that has some JPGs (either you shoot JPG or export from Lightroom as JPG), 
            and you want to convert them to HEIF or AVIF so you can import them into your iCloud/Google Photos so these photos take very little storage. 
            Here's how to quickly get yourself started.
          </p>
          <p>
            Note: This looks long because is a babysit tutorial that covers in great detail. Once you get it, it is brainless to run.
          </p>
          <h2>2.1 - Open Jupyter Notebook</h2>
          <p>
            First, open Anaconda Navigator App on your computer (Assuming you already have it installed), and open "Jupyter Notebook" inside the app.
            If you did not do the optional stuff, I assume you know what you are doing and just open a Jupyter Notebook page.
          </p>
          <p>
            A webpage should open. 
            Navigate to a place where you want to save this tool, and click "New - Notebook Python 3" on the top right of the Jupyter Notebook web page.  
          </p>
          <img src="./img/make_new_jupyter_notebook.png" width="100%" height="100%">
          <p>
            A new webpage that looks something like this should appear. First click "Untitled" to name it to something you like, for example, "jpg_hei".
            In the below right after "In [  ]: 1" is the place where you can enter some code.
          </p>
          <img src="./img/new_jupyter_notebook.png" width="100%" height="100%">
          <h2>2.2 - Make the Tool</h2>
          <p>
            Copy all the code and paste them into your newly created notebook. This code is also available on Github in <a href="https://github.com/wu-hongjun/heiya/blob/main/pipeline.ipynb">pipeline.ipynb (Link)</a>. 
          </p>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code class="language-python">
                """
                JPG to HEIF/AVIF
                Convert JPG shoot by camera to High Efficiency Images with metadata to import to iCloud photo library.

                import heiya
                import pyperclip as clip

                # Custom file path override, usually just leave it blank if you use pyperclip
                source_dir = ""

                # Get the image location directly from the clipboard
                if source_dir == "":
                    source_dir = clip.paste()
                    
                # This will convert all the JPG in source_dir to HEI.
                # source_format = 0 -> JPG. (You don't need to change this for most of the time, you can also set to 1 for PNG.)
                # target_format = 0 -> AVIF (For smaller file size but less compatible, requires iOS 16/macOS Ventura or higher).
                # target_format = 1 -> HEIF (For best compatibility but slightly larger file size, requires additional extension to open on Windows).
                heiya.to_hei.convert_image_in_dir_to_hei(source_dir, source_format=0, target_format=1)
              </code>
            </pre>
          </div>
          <p>Your notebook should already be saved, if not, do a quick "File - Save As" on the Notebook tool bar to make sure your notebook is created.</p>
          <h2>2.3 - Run the Code</h2>
          <p>Now, use Finder(macOS)/File Explorer(Windows) to go to the place where you store all of the JPGs you desire to convert.</p>
          
          <h3>2.3.1 - Copy the directory address.</h3>
          <p>Copy the directory address to your clipboard.</p>
          <li>
            Windows: File Explorer -> Go to your target folder -> Single Click address bar -> Copy the file path in address bar.
          </li>
          <li>
            macOS: Finder -> Go to your target folder -> Hold Alt (File path should apper in bottom left) -> Right click on folder and copy file path.
          </li>
          <p>
            At this point, you might have something similar to this example stored in your clipboard. 
            This is a SD card from a Fujifilm camera, your address might vary depending on where your photos are.
          </p>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code>
                D:\DCIM\207_FUJI  (Windows)
                /Volumes/SDXC/DCIM/207_FUJI  (macOS)
              </code>
            </pre>
          </div>

          <p>Now, you can do one of two things:</p>
          <li>
            If you just want to use the directory in your clipboard, do nothing.
          </li>
          <li>
            If you wish to enter a custom path, paste the address into <code>source_dir</code>.
          </li>
          
          <h3>2.3.2 -  Run the code.</h3>
          <p>Make sure to select the cell by single clicking the code.</p>
          <p>Navigate to your tool bar, and "Cells - Run Cells" to run the newly copied code. </p>
          <p>Additionally, you can use <strong>Shift + Enter</strong> on your keyboard to make this operation faster.</p>
          <p>Heiya should automatically start to convert the JPGs, and will print the progress down below.</p>
          <img src="./img/pyperclip_convert_finished.png" width="100%" height="100%">
          <p>Horray! Now just drag all the HEIF/AVIF files into Apple Photos/Google Photos and enjoy amazing photos that takes up very little storage!</p>
          
          <h2>2.4 - Conclusion</h2>
          <p>In this section, I hope I did a fair job detailing basic usage of this tool and accounted for any obstacles you might encounter using it.</p>
          <p>From now on, all you need to do is open the tool in Jupyter notebook, copy the folder path, and run the code. Should be pretty brainless.</p>
          <p>If you have any question, feel free to contact me by going to <a href="https://i.hongjunwu.com/contact/">my contact page (Link)</a>.</p>

          <h2>2.5 - H.264 to H.265 Video Encoding</h2>
          <p>Many cameras nowadays shoot video in the H.264 codec, which is compatible to most devices, but the legacy encoding yields a larger file size.</p>
          <p>
            More advanced cameras can shoot H.265 codec (Some call it HEVC codec), 
            which is a more modern codec that yields significantly smaller file size, 
            and modern hardware and operating system now have better support for the Codec 
            (Although you do need to pay a small amount of money to use it on Windows, Apple devices have no problems).
          </p>
          <p>With a little setup, you can transcode video using similar workflow mentioned above in the image processing section.</p>

          <h3>2.5.1 - Install FFMPEG to System Path</h3>
          <p>Heiya will call an video encoder called FFMPEG to transcode your videos, which is not bundled in Heiya and require manual setup.</p>
          <p>Fortunately, other people have already written comprehensive guides on how to do this, so please set up FFMPEG using these very helpful guides.</p>
          <li>
            <a href="https://adamtheautomator.com/install-ffmpeg/">Back to the Basics: Use and Install FFmpeg, Nicholas Xuan Nguyen, TALearning, 2022.</a>
          </li>
          
          <h3>2.5.2 - Make the Tool</h3>
          <p>
            Similar to the above <code>heiya.to_hei.convert_image_in_dir_to_hei()</code> function that will convert all the images in a directory to HEI, 
            as of version <code>2.3.0</code>, 
            you can now convert all video in a directory to MP4 that are encoded using the H.265 codec using a similar function <code>heiya.to_hei.convert_video_in_dir_to_h265()</code>.
          </p>
          <p>This code is also available in the demo pipeline: <a href="https://github.com/wu-hongjun/heiya/blob/main/pipeline.ipynb">pipeline.ipynb</a></p>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code class="language-python">
                """
                MP4 (H264) to MP4 (H265)
                Convert MP4/MKV (H264) to MP4(H265) using libx265 Software Encoding.
                """

                import heiya
                import pyperclip as clip

                # Custom file path override, usually just leave it blank if you use pyperclip
                source_dir = ""

                # Get the image location directly from the clipboard
                if source_dir == "":
                    source_dir = clip.paste()
                    
                # This will convert all the MP4/MKV in source_dir to .MP4 using H265 codec.
                # source_format = 0 -> MP4. (You don't need to change this for most of the time, you can also set to 1 for MKV.)
                heiya.to_hei.convert_video_in_dir_to_h265(source_dir, source_format=0, postpend="_h265")
              </code>
            </pre>
          </div>
          <p>
            Note that <code>heiya.to_hei.convert_video_in_dir_to_h265()</code> has a new parameter called <code>postpend="_h265</code>. 
            This parameter will postpend "_h265" after the file name of the generated file.
            This is because often you will have the original file also having the ".MP4" extension and we don't want to overwrite the original.
          </p>
      
        <section class="js-section">
          <h3 class="section__title">Chapter 3: Advanced Usage</h3>
          <p>There are several functions that are also potentially useful but not demonstrated in the guide above.</p>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code class="language-python">
                # Convert one image to HEIF/AVIF
                heiya.to_hei.convert_image_to_hei(source_image, target_format)

                # Convert one video to H265
                heiya.to_hei.video_to_h265(source_video, output, postpend)

                # Convert AVIF/HEIF to image
                heiya.from_hei.convert_hei_to_image(source_hei, target_format)
                heiya.from_hei.convert_hei_in_dir_to_image(source_dir, source_format, target_format)
                heiya.from_hei.convert_hei_in_dir_to_jpg(source_dir, source_format)

                # Transfer EXIF from one image to another
                heiya.meta_transfer.img_meta_transfer(source_image, target_image, lens_model)
              </code>
            </pre>
          </div>
          <p>For now, I have limited time and effort, so any advanced usage and how to use other functions of Heiya can be found in the following notebooks.</p>
          <table id="customers">
            <tr>
              <th>Name</th>
              <th>Link</th>
            </tr>
            <tr>
              <td>Pipeline Demo (Recommended)</td>
              <td><a href="https://github.com/wu-hongjun/heiya/blob/main/pipeline.ipynb">https://github.com/wu-hongjun/heiya/blob/main/heiya_basic_demo.ipynb</a></td>
            </tr>
            <tr>
              <td>Heiya Basic Demo (Extra)</td>
              <td><a href="https://github.com/wu-hongjun/heiya/blob/main/heiya_basic_demo.ipynb">https://github.com/wu-hongjun/heiya/blob/main/heiya_basic_demo.ipynb</a></td>
            </tr>
            <tr>
              <td>Heiya Full Demo (Extra)</td>
              <td><a href="https://github.com/wu-hongjun/heiya/blob/main/heiya_full_demo.ipynb">https://github.com/wu-hongjun/heiya/blob/main/heiya_full_demo.ipynb</a></td>
            </tr>
          </table>
          <hr />
        </section>

        <section class="js-section">
          <h3 class="section__title">Chapter 4: Heiya Functions</h3>
          <p>This chapter will be the home to document all the functions available to call independently so you can build your own pipeline.</p>
          <p>It is work in progress, and most information you are looking for can be found in the <strong>Advanced Usage</strong> section above.</p>
          <hr />
        </section>
        
        <section class="js-section">
          <h3 class="section__title">Chapter 5: To-Do</h3>
          <p>Some potential improvements that can be done include:</p>
          <li>
            Currently Heiya only supports converting to 8-bit (Which is mostly enough, since JPG can do at most 8 bit). 
            However, enabling Conversion to 10bit(HEIF) or 12bit(AVIF) is a welcomed improvement.
          </li>
          <li>
            One potential solution to enable higher bitrate is to deprecate <code>pillow_heif</code> and instead rewrite the entire tool using <code>imagemagick</code>. 
            Although I shall note that if you have a camera that already shoots HEIF, you probably don't need this tool.
          </li>
          <li>
            Some additional video encoding capabilities is under active development by wrapping <code>ffmpeg</code>.
          </li>
          <li>
            Of course, a Heiya GUI would be nice.
          </li>
          <li>
            An automatic deployment of the tool might be a welcomed addition too.
          </li>
          <hr />
        </section>

        <section class="js-section">
          <h3 class="section__title">Chapter 6: License</h3>
          <p>Heiya is distributed in the license in <a href="https://github.com/wu-hongjun/heiya/blob/main/LICENSE.txt">LICENSE.txt</a>.</p>
          <hr />
        </section>
      </article>
    </div>

    <footer class="footer">Copyright <a href="https://hongjunwu.com" target="_blank" class="link link--light">Hongjun Wu</a>, all rights reserved, 2023.</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script> -->
    
    <script>hljs.initHighlightingOnLoad();</script>
    <script>hljs.highlightAll();</script>

    <script src="scribbler.js"></script>
  </body>
</html>